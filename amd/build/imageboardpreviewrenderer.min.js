define("unilabeltype_imageboard/imageboardpreviewrenderer",["exports","core/templates"],(function(_exports,_templates){var obj;
/**
   * Unilabel type imageboard
   *
   * @author      Andreas Schenkel
   * @copyright   Andreas Schenkel {@link https://github.com/andreasschenkel}
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.init=()=>{function focusoutExecute(event){console.log("focusoutExecute",event);var number=function(event){let imageidselectors=["id_unilabeltype_imageboard_title_","id_unilabeltype_imageboard_xposition_","id_unilabeltype_imageboard_yposition_","id_unilabeltype_imageboard_targetwidth_","id_unilabeltype_imageboard_targetheight_","id_unilabeltype_imageboard_border_"];const eventid=event.target.getAttribute("id");for(let i=0;i<imageidselectors.length;i++)if(eventid.includes(imageidselectors[i]))return eventid.split(imageidselectors[i])[1];return-1}(event);number>=0?refreshImage(number):(console.log("refreshAllImages"),refreshAllImages())}function onclickExecute(event){event.target.getAttribute("id").split("button-mform1")[1]&&setTimeout((function(){addImageToDom(document.querySelectorAll('[id^="fitem_id_unilabeltype_imageboard_title_"]').length-1)}),500)}function refreshBackgroundImage(){let previewimage=document.getElementById("id_unilabeltype_imageboard_backgroundimage_fieldset").getElementsByClassName("realpreview"),backgrounddiv=document.getElementById("unilabel-imageboard-background-area");if(previewimage.length>0){let backgroundurl=previewimage[0].getAttribute("src").split("?")[0];previewimage[0].getAttribute("src").split("?")[1].includes("&oid=")&&(backgroundurl+="?oid="+previewimage[0].getAttribute("src").split("&oid=")[1]),backgrounddiv.style.background="red",backgrounddiv.style.backgroundSize="cover",backgrounddiv.style.backgroundImage="url('"+backgroundurl+"')";let canvaswidth=document.getElementById("id_unilabeltype_imageboard_canvaswidth").selectedOptions[0].value;backgrounddiv.style.width=canvaswidth+"px";let canvasheight=document.getElementById("id_unilabeltype_imageboard_canvasheight").selectedOptions[0].value;backgrounddiv.style.height=canvasheight+"px"}else{backgrounddiv.style.background="green",backgrounddiv.style.backgroundImage="url('')";let canvaswidth=document.getElementById("id_unilabeltype_imageboard_canvaswidth").selectedOptions[0].value;backgrounddiv.style.width=canvaswidth+"px";let canvasheight=document.getElementById("id_unilabeltype_imageboard_canvasheight").selectedOptions[0].value;backgrounddiv.style.height=canvasheight+"px"}}function refreshAllImages(){console.log("refreshAllImages");const singleElements=document.querySelectorAll('[id^="fitem_id_unilabeltype_imageboard_image_"]');for(let i=0;i<singleElements.length;i++){let number=singleElements[i].getAttribute("id").split("fitem_id_unilabeltype_imageboard_image_")[1];null===document.getElementById("unilabel-imageboard-imageid-"+number)?(addImageToDom(number),console.log("214"),setTimeout((function(){console.log("verzÃ¶gerter refresh"),refreshImage(number)}),1e3)):refreshImage(number)}}function addImageToDom(number){console.log("addImageToDom"+number);if(null===document.getElementById("unilabel-imageboard-imageid-"+number)){console.log("imageid ist null"),renderAddedImage(number),console.log("renderAddedImage fertig");let imagefileNode=document.getElementById("fitem_id_unilabeltype_imageboard_image_"+number);if(console.log("renderAddedImage fertig"),imagefileNode){new MutationObserver(refreshImage).observe(imagefileNode,{attributes:!0,childList:!0,subtree:!0})}console.log("before refreshImage number"),console.log("after refreshImage number")}else refreshImage(number)}function renderAddedImage(number){console.log("renderAddedImage number",renderAddedImage,number);const context={number:number,title:"hurzenschnurz"};_templates.default.renderForPromise("unilabeltype_imageboard/previewelement",context).then((_ref=>{let{html:html,js:js}=_ref,imageboardcontainer=document.getElementById("imageboardcontainer").innerHTML;console.log("imagehtml",html),console.log("imageboardcontainer",imageboardcontainer);let combiniert="<div>"+imageboardcontainer+"</div>"+html;console.log("imagehtmlcombiniert",combiniert),_templates.default.replaceNodeContents("#imageboardcontainer",combiniert,js),console.log("replaceNodeContents fertig")})).catch((()=>{}))}function refreshImage(number){if(Array.isArray(number))setTimeout((function(){refreshAllImages()}),600);else{let imageid=document.getElementById("unilabel-imageboard-imageid-"+number),imagedata=function(number){let imageids={title:"id_unilabeltype_imageboard_title_"+number,titlecolor:"id_unilabeltype_imageboard_titlecolor_colourpicker",titlebackgroundcolor:"id_unilabeltype_imageboard_titlebackgroundcolor_colourpicker",fontsize:"id_unilabeltype_imageboard_fontsize",xposition:"id_unilabeltype_imageboard_xposition_"+number,yposition:"id_unilabeltype_imageboard_yposition_"+number,targetwidth:"id_unilabeltype_imageboard_targetwidth_"+number,targetheight:"id_unilabeltype_imageboard_targetheight_"+number,src:"",border:"id_unilabeltype_imageboard_border_"+number},imagedata=[];imagedata.title=document.getElementById(imageids.title).value,imagedata.titlecolor=document.getElementById(imageids.titlecolor).value,imagedata.titlebackgroundcolor=document.getElementById(imageids.titlebackgroundcolor).value,imagedata.fontsize=document.getElementById(imageids.fontsize).value,imagedata.xposition=document.getElementById(imageids.xposition).value,imagedata.yposition=document.getElementById(imageids.yposition).value,imagedata.targetwidth=document.getElementById(imageids.targetwidth).value,imagedata.targetheight=document.getElementById(imageids.targetheight).value;const imagetag=document.getElementById("id_unilabeltype_imageboard_image_"+number+"_fieldset").getElementsByTagName("img");let src="";imagetag.length&&0!=imagetag.length&&(src=imagetag[0].src,src=src.split("?")[0]);return imagedata.src=src,imagedata.border=document.getElementById(imageids.border).value,imagedata}(number);imageid.style.background=imagedata.titlebackgroundcolor,imageid.src=imagedata.src;const imagediv=document.getElementById("unilabel-imageboard-element-"+number);imagediv.style.left=parseInt(imagedata.xposition)+"px",imagediv.style.top=parseInt(imagedata.yposition)+"px",0!=imagedata.targetwidth?imageid.style.width=imagedata.targetwidth+"px":imageid.style.width="auto",0!=imagedata.targetheight?imageid.style.height=imagedata.targetheight+"px":imageid.style.height="auto",""!=imagedata.title?imageid.title=imagedata.title:imageid.title="",0!=imagedata.border?(imageid.style.border=imagedata.border+"px solid",imageid.style.borderColor=imagedata.titlebackgroundcolor):imageid.style.border="0";let title=imagedata.title;const elementtitle=document.getElementById("id_elementtitle-"+number);elementtitle.innerHTML=title,elementtitle.style.color=imagedata.titlecolor,elementtitle.style.backgroundColor=imagedata.titlebackgroundcolor,elementtitle.style.fontSize=imagedata.fontsize+"px"}}!function(){var mform=document.querySelectorAll('[id^="mform"]')[0];mform.addEventListener("focusout",focusoutExecute,!1),mform.addEventListener("click",onclickExecute,!1);let backgroundfileNode=document.getElementById("id_unilabeltype_imageboard_backgroundimage_fieldset");if(backgroundfileNode){new MutationObserver(refreshBackgroundImage).observe(backgroundfileNode,{attributes:!0,childList:!0,subtree:!0})}let canvasx=document.getElementById("id_unilabeltype_imageboard_canvaswidth");if(canvasx){new MutationObserver(refreshBackgroundImage).observe(canvasx,{attributes:!0,childList:!0,subtree:!0})}let canvasy=document.getElementById("id_unilabeltype_imageboard_canvasheight");if(canvasy){new MutationObserver(refreshBackgroundImage).observe(canvasy,{attributes:!0,childList:!0,subtree:!0})}}(),setTimeout(refreshBackgroundImage,1e3),setTimeout(refreshAllImages,1e3),setTimeout((function(){}),500)}}));

//# sourceMappingURL=imageboardpreviewrenderer.min.js.map