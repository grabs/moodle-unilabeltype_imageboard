{"version":3,"file":"imageboarddraganddrop.min.js","sources":["../src/imageboarddraganddrop.js"],"sourcesContent":["/**\n * Unilabel type imageboard\n *\n * @author      Andreas Schenkel\n * @copyright   Andreas Schenkel {@link https://github.com/andreasschenkel}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nexport const init = () => {\n    // Store some data about the selected image that is moved.\n    var selectedImage = [];\n    selectedImage.number = null;\n    // ItemToMove is the div that the selected image is inside. We do NOT move the image we move the div.\n    selectedImage.itemToMove = null;\n    // ToDo: Add documentation about xoffset?\n    selectedImage.eventlayerX = 0;\n    selectedImage.eventlayerY = 0;\n    selectedImage.width = null;\n    selectedImage.height = null;\n\n    // Store the data about the canvas/background.\n    var canvas = null;\n    var canvaswidth = 950;\n    var canvasheight = 400;\n\n    registerDnDListener();\n\n    /**\n     *\n     */\n    function registerDnDListener() {\n        setTimeout(function() {\n            canvas = document.getElementById(\"unilabel-imageboard-background-area\");\n            canvas.addEventListener(\"dragstart\", dragStart, false);\n            canvas.addEventListener(\"drag\", drag, false);\n            canvas.addEventListener(\"dragend\", dragEnd, false);\n        }, 1000);\n    }\n\n    /**\n     *\n     * @param {event} event\n     */\n    function dragStart(event) {\n        console.log(\"xxx_dragStart\", event);\n        if (event && event.target && event.target.classList.contains('image')) {\n            // Image was selected so we have to store the information about this image.\n            // ToDo: height auto needs different code\n            selectedImage.number = event.target.getAttribute('id').split('unilabel-imageboard-imageid_')[1];\n            selectedImage.width = event.target.style.width.split('px')[0];\n            selectedImage.height = event.target.style.height.split('px')[0];\n            selectedImage.itemToMove = document.getElementById('unilabel_imageboard_imagediv_' + selectedImage.number);\n            selectedImage.eventlayerX = event.layerX;\n            selectedImage.eventlayerY = event.layerY;\n        }\n    }\n\n    /**\n     *\n     * @param {event} event\n     */\n    function drag(event) {\n        if (selectedImage.number !== null && event.target.classList.contains('image')) {\n            selectedImage.width = event.target.style.width.split('px')[0];\n            selectedImage.height = event.target.style.height.split('px')[0];\n            var xposition = calculateXposition(event);\n            var yposition = calculateYposition(event);\n            ////selectedImage.itemToMove.style.left = xposition + \"px\";\n            ////selectedImage.itemToMove.style.top = yposition + \"px\";\n            // Change the inputfield\n            const inputPositionX = document.getElementById('id_unilabeltype_imageboard_xposition_' + (selectedImage.number));\n            const inputPositionY = document.getElementById('id_unilabeltype_imageboard_yposition_' + (selectedImage.number));\n            inputPositionX.value = xposition;\n            inputPositionY.value = yposition;\n        }\n    }\n\n    /**\n     *\n     * @param {event} event\n     */\n    function dragEnd(event) {\n        console.log(\"xxx_dragEnd\", event);\n        console.log(\"selectedImage.number\", selectedImage.number);\n        if (selectedImage.number !== null ) {\n            var xposition = calculateXposition(event);\n            var yposition = calculateYposition(event);\n            selectedImage.itemToMove.style.left = xposition + \"px\";\n            selectedImage.itemToMove.style.top = yposition + \"px\";\n            // Change the inputfield\n            const inputPositionX = document.getElementById('id_unilabeltype_imageboard_xposition_' + (selectedImage.number));\n            const inputPositionY = document.getElementById('id_unilabeltype_imageboard_yposition_' + (selectedImage.number));\n            inputPositionX.value = xposition;\n            inputPositionY.value = yposition;\n            // Reset saved image data\n            selectedImage.number = null;\n        }\n    }\n\n    /**\n     *\n     * @param {event} event\n     * @returns {number}\n     */\n    function calculateXposition(event) {\n        var canvasboundings = canvas.getBoundingClientRect();\n        var xposition = event.clientX - canvasboundings.left - selectedImage.eventlayerX - 1;\n        if (xposition < 0) {\n            xposition = 0;\n        }\n        if (xposition >= canvaswidth - selectedImage.width) {\n            xposition = canvaswidth - selectedImage.width;\n        }\n        return Math.round(xposition);\n    }\n\n    /**\n     *\n     * @param {event} event\n     * @returns {number}\n     */\n    function calculateYposition(event) {\n        var canvasboundings = canvas.getBoundingClientRect();\n        var yposition = event.clientY - canvasboundings.top - selectedImage.eventlayerY - 1;\n        if (yposition < 0) {\n            yposition = 0;\n        }\n        if (yposition >= canvasheight - selectedImage.height) {\n            yposition = canvasheight - selectedImage.height;\n        }\n        return Math.round(yposition);\n    }\n};\n"],"names":["selectedImage","number","itemToMove","eventlayerX","eventlayerY","width","height","canvas","dragStart","event","console","log","target","classList","contains","getAttribute","split","style","document","getElementById","layerX","layerY","drag","xposition","calculateXposition","yposition","calculateYposition","inputPositionX","inputPositionY","value","dragEnd","left","top","canvasboundings","getBoundingClientRect","clientX","Math","round","clientY","setTimeout","addEventListener"],"mappings":"kLAQoB,SAEZA,cAAgB,GACpBA,cAAcC,OAAS,KAEvBD,cAAcE,WAAa,KAE3BF,cAAcG,YAAc,EAC5BH,cAAcI,YAAc,EAC5BJ,cAAcK,MAAQ,KACtBL,cAAcM,OAAS,SAGnBC,OAAS,cAsBJC,UAAUC,OACfC,QAAQC,IAAI,gBAAiBF,OACzBA,OAASA,MAAMG,QAAUH,MAAMG,OAAOC,UAAUC,SAAS,WAGzDd,cAAcC,OAASQ,MAAMG,OAAOG,aAAa,MAAMC,MAAM,gCAAgC,GAC7FhB,cAAcK,MAAQI,MAAMG,OAAOK,MAAMZ,MAAMW,MAAM,MAAM,GAC3DhB,cAAcM,OAASG,MAAMG,OAAOK,MAAMX,OAAOU,MAAM,MAAM,GAC7DhB,cAAcE,WAAagB,SAASC,eAAe,gCAAkCnB,cAAcC,QACnGD,cAAcG,YAAcM,MAAMW,OAClCpB,cAAcI,YAAcK,MAAMY,iBAQjCC,KAAKb,UACmB,OAAzBT,cAAcC,QAAmBQ,MAAMG,OAAOC,UAAUC,SAAS,SAAU,CAC3Ed,cAAcK,MAAQI,MAAMG,OAAOK,MAAMZ,MAAMW,MAAM,MAAM,GAC3DhB,cAAcM,OAASG,MAAMG,OAAOK,MAAMX,OAAOU,MAAM,MAAM,OACzDO,UAAYC,mBAAmBf,OAC/BgB,UAAYC,mBAAmBjB,aAI7BkB,eAAiBT,SAASC,eAAe,wCAA2CnB,cAAcC,QAClG2B,eAAiBV,SAASC,eAAe,wCAA2CnB,cAAcC,QACxG0B,eAAeE,MAAQN,UACvBK,eAAeC,MAAQJ,oBAQtBK,QAAQrB,UACbC,QAAQC,IAAI,cAAeF,OAC3BC,QAAQC,IAAI,uBAAwBX,cAAcC,QACrB,OAAzBD,cAAcC,OAAkB,KAC5BsB,UAAYC,mBAAmBf,OAC/BgB,UAAYC,mBAAmBjB,OACnCT,cAAcE,WAAWe,MAAMc,KAAOR,UAAY,KAClDvB,cAAcE,WAAWe,MAAMe,IAAMP,UAAY,WAE3CE,eAAiBT,SAASC,eAAe,wCAA2CnB,cAAcC,QAClG2B,eAAiBV,SAASC,eAAe,wCAA2CnB,cAAcC,QACxG0B,eAAeE,MAAQN,UACvBK,eAAeC,MAAQJ,UAEvBzB,cAAcC,OAAS,eAStBuB,mBAAmBf,WACpBwB,gBAAkB1B,OAAO2B,wBACzBX,UAAYd,MAAM0B,QAAUF,gBAAgBF,KAAO/B,cAAcG,YAAc,SAC/EoB,UAAY,IACZA,UAAY,GAEZA,WAxFU,IAwFiBvB,cAAcK,QACzCkB,UAzFU,IAyFgBvB,cAAcK,OAErC+B,KAAKC,MAAMd,oBAQbG,mBAAmBjB,WACpBwB,gBAAkB1B,OAAO2B,wBACzBT,UAAYhB,MAAM6B,QAAUL,gBAAgBD,IAAMhC,cAAcI,YAAc,SAC9EqB,UAAY,IACZA,UAAY,GAEZA,WAxGW,IAwGiBzB,cAAcM,SAC1CmB,UAzGW,IAyGgBzB,cAAcM,QAEtC8B,KAAKC,MAAMZ,WAnGlBc,YAAW,YACPhC,OAASW,SAASC,eAAe,wCAC1BqB,iBAAiB,YAAahC,WAAW,GAChDD,OAAOiC,iBAAiB,OAAQlB,MAAM,GACtCf,OAAOiC,iBAAiB,UAAWV,SAAS,KAC7C"}