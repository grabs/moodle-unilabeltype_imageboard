{"version":3,"file":"imageboarddraganddrop.min.js","sources":["../src/imageboarddraganddrop.js"],"sourcesContent":["/**\n * Unilabel type imageboard\n *\n * @author      Andreas Schenkel\n * @copyright   Andreas Schenkel {@link https://github.com/andreasschenkel}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n//import Templates from 'core/templates';;\n\nexport const init = () => {\n    // Create an array selectedImage to be able to store some data about the selected image that is moved.\n    var selectedImage = [];\n    selectedImage.number = null;\n    selectedImage.number = null;\n    selectedImage.src = '';\n    // ItemToMove is the div that the selected image is inside AND the title. We do NOT move the image we move the itemtomove-div.\n    selectedImage.itemToMove = null;\n    // ToDo: Add documentation about xoffset?\n    selectedImage.eventlayerX = 0;\n    selectedImage.eventlayerY = 0;\n    selectedImage.width = null;\n    selectedImage.height = null;\n\n    // Store the data about the canvas/background.\n    var canvas = null;\n    var canvaswidth = 950;\n    var canvasheight = 400;\n    registerDnDListener();\n\n    /**\n     *  We need two event listeners for drag and drop. One when the dragging starts and one when it ends.\n     */\n    function registerDnDListener() {\n        setTimeout(function() {\n            canvas = document.getElementById(\"unilabel-imageboard-background-canvas\");\n            canvas.addEventListener(\"dragstart\", dragStart, false);\n            canvas.addEventListener(\"drag\", drag, false);\n            canvas.addEventListener(\"dragend\", dragEnd, false);\n        }, 1000);\n    }\n\n    /**\n     * ToDo: height auto needs different code\n     * @param {event} event\n     */\n    function dragStart(event) {\n        console.log(\"dragStart event\", event);\n        if (event && event.target && event.target.classList.contains('unilabel-imageboard-element-draggable')) {\n            // Image was selected, so we have to store the information about this image.\n            // 1. Get the number of the selected element.\n            let number = event.target.getAttribute('id').split('unilabel-imageboard-element-')[1];\n            // 2. Get imagedata of the selected element.\n            let imagedata = getAllImagedataFromForm(number);\n            // 3. Set the number of the selected image so this image can be updated when dragEnds.\n            selectedImage.number = number;\n            // 4. Collect the other information.\n            selectedImage.title = imagedata['title'];\n            selectedImage.fontsize = imagedata['fontsize'];\n            selectedImage.width = imagedata['targetwidth'];\n            selectedImage.height = imagedata['targetheight'];\n            selectedImage.itemToMove = document.getElementById('unilabel-imageboard-element-' + selectedImage.number);\n            // layerX and layerY is the relative position of the mouseposition inside div\n            // div is the image or the title so layer depends on this according to the complete element.\n            // ToDo: DragAndDrop of title\n            selectedImage.eventlayerX = event.layerX;\n            selectedImage.eventlayerY = event.layerY;\n        }\n    }\n\n    /**\n     *\n     * @param {event} event\n     */\n    function drag(event) {\n        console.log(\"drag event.offsetX\", event.offsetX);\n        console.log(\"drag selectedImage.itemToMove.style.left\", selectedImage.itemToMove.style.left);\n        console.log(\"event.target\", event.target);\n        console.log(\"-- event.target.style\", event.target.style);\n        // var xposition = calculateXposition(event);\n       // console.log(\"xposition\", xposition);\n       // var yposition = calculateYposition(event);\n       // console.log(\"yposition\", yposition);\n    }\n\n    /**\n     *\n     * @param {event} event\n     */\n    function dragEnd(event) {\n        console.log(\"dragEnd\", event);\n        console.log(\"drag event.offsetX\", event.offsetX);\n        if (selectedImage.number !== null ) {\n            var xposition = calculateXposition(event);\n            console.log(\"xposition\", xposition);\n            var yposition = calculateYposition(event);\n            console.log(\"yposition\", yposition);\n            selectedImage.itemToMove.style.left = xposition + \"px\";\n            selectedImage.itemToMove.style.top = yposition + \"px\";\n            // Change the inputfield\n            const inputPositionX = document.getElementById('id_unilabeltype_imageboard_xposition_' + (selectedImage.number));\n            const inputPositionY = document.getElementById('id_unilabeltype_imageboard_yposition_' + (selectedImage.number));\n            inputPositionX.value = xposition;\n            inputPositionY.value = yposition;\n            // Reset saved image data\n            selectedImage.number = null;\n        }\n    }\n\n    /**\n     * Get all data from image that is stored in the form and collects them in one array.\n     *\n     * @param {int} number of the image\n     * @returns {*[]} Array with the collected information that are set in the form for the image.\n     */\n    function getAllImagedataFromForm(number) {\n        //console.log(\"getAllImagedataFromForm number= \" + number);\n        let imageids = {\n            title: 'id_unilabeltype_imageboard_title_' + number,\n            titlecolor: 'id_unilabeltype_imageboard_titlecolor_colourpicker',\n            titlebackgroundcolor: 'id_unilabeltype_imageboard_titlebackgroundcolor_colourpicker',\n            fontsize: 'id_unilabeltype_imageboard_fontsize',\n            xposition: 'id_unilabeltype_imageboard_xposition_' + number,\n            yposition: 'id_unilabeltype_imageboard_yposition_' + number,\n            targetwidth: 'id_unilabeltype_imageboard_targetwidth_' + number,\n            targetheight: 'id_unilabeltype_imageboard_targetheight_' + number,\n            src: '',\n            border: 'id_unilabeltype_imageboard_border_' + number,\n        };\n\n        let imagedata = [];\n        //console.log(\"document.getElementById(imageids.title)\", document.getElementById(imageids.title));\n        imagedata['title'] = document.getElementById(imageids.title).value;\n        imagedata['titlecolor'] = document.getElementById(imageids.titlecolor).value;\n        imagedata['titlebackgroundcolor'] = document.getElementById(imageids.titlebackgroundcolor).value;\n        imagedata['fontsize'] = document.getElementById(imageids.fontsize).value;\n        imagedata['xposition'] = document.getElementById(imageids.xposition).value;\n        imagedata['yposition'] = document.getElementById(imageids.yposition).value;\n        imagedata['targetwidth'] = document.getElementById(imageids.targetwidth).value;\n        imagedata['targetheight'] = document.getElementById(imageids.targetheight).value;\n\n        // Src der Draftfile ermitteln\n        const element = document.getElementById('id_unilabeltype_imageboard_image_' + number + '_fieldset');\n        const imagetag = element.getElementsByTagName('img');\n        let src = '';\n        if (imagetag.length && imagetag.length != 0) {\n            src = imagetag[0].src;\n            src = src.split('?')[0];\n        }\n        imagedata['src'] = src;\n        imagedata['border'] = document.getElementById(imageids.border).value;\n\n        return imagedata;\n    }\n\n    /**\n     *\n     * @param {event} event\n     * @returns {number}\n     */\n    function calculateXposition(event) {\n\n        console.log(\"------calculateXposition\");\n        console.log(\"event\", event);\n\n        var canvasboundings = canvas.getBoundingClientRect();\n        console.log(\"canvasboundings\", canvasboundings);\n\n\n        var dummy = event.dataTransfer;\n        console.log(\" event.dataTransfer\", dummy);\n\n        console.log(\"event.clientX\", event.clientX);\n        console.log(\"canvasboundings.left\", canvasboundings.left);\n        console.log(\"selectedImage.eventlayerX\", selectedImage.eventlayerX);\n\n        //var xposition = event.clientX - canvasboundings.left - selectedImage.eventlayerX - 1;\n        var xposition = event.clientX - canvasboundings.left - selectedImage.eventlayerX - 1;\n\n        if (xposition < 0) {\n            xposition = 0;\n        }\n        if (xposition >= canvaswidth - selectedImage.width) {\n            xposition = canvaswidth - selectedImage.width;\n        }\n        return Math.round(xposition);\n    }\n\n    /**\n     *\n     * @param {event} event\n     * @returns {number}\n     */\n    function calculateYposition(event) {\n        var canvasboundings = canvas.getBoundingClientRect();\n        var yposition = event.clientY - canvasboundings.top - selectedImage.eventlayerY - 1;\n        if (yposition < 0) {\n            yposition = 0;\n        }\n        if (yposition >= canvasheight - selectedImage.height) {\n            yposition = canvasheight - selectedImage.height;\n        }\n        return Math.round(yposition);\n    }\n};\n"],"names":["selectedImage","number","src","itemToMove","eventlayerX","eventlayerY","width","height","canvas","dragStart","event","console","log","target","classList","contains","getAttribute","split","imagedata","imageids","title","titlecolor","titlebackgroundcolor","fontsize","xposition","yposition","targetwidth","targetheight","border","document","getElementById","value","imagetag","getElementsByTagName","length","getAllImagedataFromForm","layerX","layerY","drag","offsetX","style","left","dragEnd","canvasboundings","getBoundingClientRect","dummy","dataTransfer","clientX","Math","round","calculateXposition","clientY","top","calculateYposition","inputPositionX","inputPositionY","setTimeout","addEventListener"],"mappings":"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"}